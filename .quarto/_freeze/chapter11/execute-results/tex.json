{
  "hash": "c1327f09922501f175546bfacda23af2",
  "result": {
    "engine": "knitr",
    "markdown": "## 第11章 \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npacman::p_load(psych, GPArotation, tidyverse, readxl, gt, gtExtras, dendextend, cluster, factoextra, useful, ggrepel)\n\n# コード11-1\n# install.packages(\"psych\")\n# install.packages(\"GPArotation\")\n\n# コード11-2\nfactor_exdata <- readxl::read_excel(\"data/factor_ex.xlsx\", na = \".\")\n\nfactor_exdata$V5 <- 8 - factor_exdata$V5\nrownames(factor_exdata) <- factor_exdata$ID\n\nfactor_exdata2 <- factor_exdata %>%\n  select(-ID)\nknitr::kable(summary(factor_exdata2))\n```\n\n::: {.cell-output-display}\n\n\n|   |      V1      |      V2    |      V3    |      V4    |      V5    |      V6      |\n|:--|:-------------|:-----------|:-----------|:-----------|:-----------|:-------------|\n|   |Min.   :1.000 |Min.   :2.0 |Min.   :1.0 |Min.   :2.0 |Min.   :1.0 |Min.   :2.000 |\n|   |1st Qu.:2.000 |1st Qu.:3.0 |1st Qu.:2.0 |1st Qu.:3.0 |1st Qu.:3.0 |1st Qu.:3.000 |\n|   |Median :4.000 |Median :4.0 |Median :4.0 |Median :4.0 |Median :4.5 |Median :4.000 |\n|   |Mean   :3.933 |Mean   :3.9 |Mean   :4.1 |Mean   :4.1 |Mean   :4.5 |Mean   :4.167 |\n|   |3rd Qu.:6.000 |3rd Qu.:5.0 |3rd Qu.:6.0 |3rd Qu.:5.0 |3rd Qu.:6.0 |3rd Qu.:4.750 |\n|   |Max.   :7.000 |Max.   :7.0 |Max.   :7.0 |Max.   :7.0 |Max.   :7.0 |Max.   :7.000 |\n\n\n:::\n\n```{.r .cell-code}\n# コード11-3\nknitr::kable(cor(factor_exdata2), caption = \"相関行列\")\n```\n\n::: {.cell-output-display}\n\n\nTable: 相関行列\n\n|   |         V1|         V2|         V3|         V4|         V5|         V6|\n|:--|----------:|----------:|----------:|----------:|----------:|----------:|\n|V1 |  1.0000000| -0.0532178|  0.8730902| -0.0861622|  0.8576366|  0.0041681|\n|V2 | -0.0532178|  1.0000000| -0.1550200|  0.5722121| -0.0197456|  0.6404649|\n|V3 |  0.8730902| -0.1550200|  1.0000000| -0.2477879|  0.7778480| -0.0180688|\n|V4 | -0.0861622|  0.5722121| -0.2477879|  1.0000000|  0.0065819|  0.6404649|\n|V5 |  0.8576366| -0.0197456|  0.7778480|  0.0065819|  1.0000000|  0.1364029|\n|V6 |  0.0041681|  0.6404649| -0.0180688|  0.6404649|  0.1364029|  1.0000000|\n\n\n:::\n\n```{.r .cell-code}\n# コード11-4\ncor.exdata <- cor(factor_exdata2)\n\nVSS.scree(cor.exdata)\n```\n\n::: {.cell-output-display}\n![](chapter11_files/figure-pdf/unnamed-chunk-1-1.png){fig-align='center' fig-pos='H'}\n:::\n\n```{.r .cell-code}\n# コード11-5\nfa <- fa(r = factor_exdata2, nfactors = 2,\n  rotate = \"promax\", fm = \"ml\")\nfa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nFactor Analysis using method =  ml\nCall: fa(r = factor_exdata2, nfactors = 2, rotate = \"promax\", fm = \"ml\")\nStandardized loadings (pattern matrix) based upon correlation matrix\n     ML1   ML2   h2    u2 com\nV1  0.97  0.00 0.94 0.063   1\nV2 -0.02  0.75 0.56 0.437   1\nV3  0.89 -0.12 0.83 0.174   1\nV4 -0.06  0.78 0.62 0.378   1\nV5  0.89  0.11 0.79 0.205   1\nV6  0.08  0.83 0.69 0.309   1\n\n                       ML1  ML2\nSS loadings           2.54 1.89\nProportion Var        0.42 0.32\nCumulative Var        0.42 0.74\nProportion Explained  0.57 0.43\nCumulative Proportion 0.57 1.00\n\n With factor correlations of \n      ML1   ML2\nML1  1.00 -0.06\nML2 -0.06  1.00\n\nMean item complexity =  1\nTest of the hypothesis that 2 factors are sufficient.\n\ndf null model =  15  with the objective function =  4.25 with Chi Square =  111.31\ndf of  the model are 4  and the objective function was  0.21 \n\nThe root mean square of the residuals (RMSR) is  0.03 \nThe df corrected root mean square of the residuals is  0.05 \n\nThe harmonic n.obs is  30 with the empirical chi square  0.65  with prob <  0.96 \nThe total n.obs was  30  with Likelihood Chi Square =  5.21  with prob <  0.27 \n\nTucker Lewis Index of factoring reliability =  0.95\nRMSEA index =  0.095  and the 90 % confidence intervals are  0 0.314\nBIC =  -8.39\nFit based upon off diagonal values = 1\nMeasures of factor score adequacy             \n                                                   ML1  ML2\nCorrelation of (regression) scores with factors   0.98 0.92\nMultiple R square of scores with factors          0.96 0.84\nMinimum correlation of possible factor scores     0.92 0.68\n```\n\n\n:::\n\n```{.r .cell-code}\n# コード11-6\nfa.diagram(fa)\n```\n\n::: {.cell-output-display}\n![](chapter11_files/figure-pdf/unnamed-chunk-1-2.png){fig-align='center' fig-pos='H'}\n:::\n\n```{.r .cell-code}\n# コード11-7\nfs <- data.frame(fa$scores)\nfactor_exdata2$rowname <- rownames(factor_exdata2)\nfs$rowname <- rownames(fs)\nfactor_exdata2 <- left_join(factor_exdata2, fs, by = \"rowname\")\nknitr::kable(head(factor_exdata2), caption = \"結合後データ\")\n```\n\n::: {.cell-output-display}\n\n\nTable: 結合後データ\n\n| V1| V2| V3| V4| V5| V6|rowname |        ML1|        ML2|\n|--:|--:|--:|--:|--:|--:|:-------|----------:|----------:|\n|  7|  3|  6|  4|  6|  4|1       |  1.3106155| -0.2896470|\n|  1|  3|  2|  4|  3|  4|2       | -1.2878038| -0.2073067|\n|  6|  2|  7|  4|  7|  3|3       |  1.1828544| -0.7996332|\n|  4|  5|  4|  6|  6|  5|4       |  0.1474225|  1.0035837|\n|  1|  2|  2|  3|  2|  2|5       | -1.3907544| -1.3067260|\n|  6|  3|  6|  4|  6|  4|6       |  0.9928111| -0.2875982|\n\n\n:::\n\n```{.r .cell-code}\n# コード11-8\n\nex_cluster <- factor_exdata2 %>%\n  select(ML1, ML2)\nHier1 <- agnes(ex_cluster, metric = \"euclidian\", stand = TRUE)\npltree(Hier1)\n```\n\n::: {.cell-output-display}\n![](chapter11_files/figure-pdf/unnamed-chunk-1-3.png){fig-align='center' fig-pos='H'}\n:::\n\n```{.r .cell-code}\n# コード11-9\ncl_1 <- kmeans(ex_cluster, 3)\nclus_fa <- data.frame(cl_1$cluster)\nclus_fa$rowname <- rownames(clus_fa)\nfactor_exdata2 <- left_join(factor_exdata2, clus_fa, by = \"rowname\")\nfactor_exdata2$cl_1.cluster <- factor(factor_exdata2$cl_1.cluster)\n\n# Visualizing the clusters with 2 factors\np1 <- ggplot(data = factor_exdata2,\n             mapping = aes(x = ML1, y = ML2, color = cl_1.cluster))\np1 + geom_point() +\n  geom_text_repel(mapping = aes(label = rownames(factor_exdata2))) +\n  labs(x = \"Ease of use\", y = \"Design\")\n```\n\n::: {.cell-output-display}\n![](chapter11_files/figure-pdf/unnamed-chunk-1-4.png){fig-align='center' fig-pos='H'}\n:::\n\n```{.r .cell-code}\n# コード11-10\nfactor_exdata3 <- factor_exdata %>%\n  select(-ID)\npca_res <- pca(factor_exdata3, nfactors = 2, rotate = \"none\")\npca_res\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPrincipal Components Analysis\nCall: principal(r = r, nfactors = nfactors, residuals = residuals, \n    rotate = rotate, n.obs = n.obs, covar = covar, scores = scores, \n    missing = missing, impute = impute, oblique.scores = oblique.scores, \n    method = method, use = use, cor = cor, correct = 0.5, weight = NULL)\nStandardized loadings (pattern matrix) based upon correlation matrix\n     PC1  PC2   h2    u2 com\nV1  0.93 0.25 0.93 0.074 1.1\nV2 -0.30 0.80 0.72 0.277 1.3\nV3  0.94 0.13 0.89 0.106 1.0\nV4 -0.34 0.79 0.74 0.261 1.4\nV5  0.87 0.35 0.88 0.122 1.3\nV6 -0.18 0.87 0.79 0.210 1.1\n\n                       PC1  PC2\nSS loadings           2.73 2.22\nProportion Var        0.46 0.37\nCumulative Var        0.46 0.82\nProportion Explained  0.55 0.45\nCumulative Proportion 0.55 1.00\n\nMean item complexity =  1.2\nTest of the hypothesis that 2 components are sufficient.\n\nThe root mean square of the residuals (RMSR) is  0.07 \n with the empirical chi square  3.94  with prob <  0.41 \n\nFit based upon off diagonal values = 0.98\n```\n\n\n:::\n\n```{.r .cell-code}\n# コード11-11\n# データの相関行列から固有値と固有ベクトルを抽出\ncor_ex <- cor(factor_exdata3)\neigen_list <- eigen(cor_ex)\n\n# 固有ベクトルについての情報をオブジェクトとして定義\npc1_eig <- eigen_list$vectors[, 1]\npc2_eig <- eigen_list$vectors[, 2]\n\n# 固有ベクトルに，固有値の平方根を乗じる\nPC1 <- pc1_eig * sqrt(eigen_list$values[1])\nPC2 <- pc2_eig * sqrt(eigen_list$values[2])\nknitr::kable(data.frame(cbind(PC1, PC2)), caption = \"計算結果\")\n```\n\n::: {.cell-output-display}\n\n\nTable: 計算結果\n\n|        PC1|        PC2|\n|----------:|----------:|\n|  0.9283425| -0.2532285|\n| -0.3005297| -0.7952496|\n|  0.9361812| -0.1308894|\n| -0.3415817| -0.7889663|\n|  0.8687553| -0.3507939|\n| -0.1766389| -0.8711581|\n\n\n:::\n:::\n\n\n",
    "supporting": [
      "chapter11_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}