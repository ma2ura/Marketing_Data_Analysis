{
  "hash": "c3129b057873840a394b17afa7a2a682",
  "result": {
    "engine": "knitr",
    "markdown": "## データ整理と要約\n\n第4章は、データを読み込んで、形を整えて、特徴をつかむためのデータを要約する方法を学びます。\nRは最初から用意されている基本関数だけでも十分強力ですが、外部で開発された様々なパッケージを使うと、さらに便利にデータ操作ができます。\n\nはじめに外部のパッケージをインストールしてRの機能を拡張します。\nRでデータを操作する際に超強力なパッケージ群である`tidyverse`を読み込みます。\nあとで使うExcelファイルを読み込むための`readxl`パッケージも一緒に読み込みます。\n\nテキストでは、`install.packages()`関数でパッケージをインストールして、`library()`関数で読み込んでいますが、ここでは<span class = \"markp\">pacman`パッケージを使って、必要なパッケージを一括でインストールおよび読み込みをします</span>。\n\nまず始めに、`pacman`パッケージをインストールします。\nこの作業はここで1回だけです。以降はこのコードは実行しなくて大丈夫です。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# first time only\ninstall.packages(\"pacman\")\n```\n:::\n\n\n次に、`pacman`パッケージの`p_load()`関数を使って，`tidyverse`と`readxl`パッケージをインストールおよび読み込みします。\n`::`という記法はパッケージ名を明示的に指定して関数を使う方法ですが、ここでは`pacman`パッケージの`p_load()`関数を指定して使っています。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, readxl, gt, gtExtras)\n```\n:::\n\n\n:::{.column-margin}\n一度`pacman`パッケージをインストールすれば、あとは`pacman::p_load()`関数を使うだけで、指定したパッケージがインストールされていなければ自動的にインストールし、読み込みまで行ってくれます。非常に便利です。\n:::\n\n作業ディレクトリ内の`data`フォルダに入っている`2022idpos.csv`というデータを読み込みます。\n何を読み込んだのか確認するために，基本関数`head()`でデータの先頭6行を表示させます。\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nidpos <- readr::read_csv(\"data/2022idpos.csv\", na = \".\")\nidpos |> head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"date\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"spent\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"coupon\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"12\",\"2\":\"2019/9/25\",\"3\":\"14326\",\"4\":\"1\"},{\"1\":\"32\",\"2\":\"2019/9/10\",\"3\":\"10232\",\"4\":\"1\"},{\"1\":\"30\",\"2\":\"2019/9/9\",\"3\":\"6881\",\"4\":\"1\"},{\"1\":\"29\",\"2\":\"2019/9/4\",\"3\":\"6365\",\"4\":\"0\"},{\"1\":\"46\",\"2\":\"2019/9/10\",\"3\":\"7595\",\"4\":\"1\"},{\"1\":\"44\",\"2\":\"2019/9/14\",\"3\":\"7858\",\"4\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n:::{.column-margin}\n`readr`パッケージの`read_csv()`関数は，CSV形式のデータを読み込むための関数です。`na = \".\"`という引数は，データ内の`.`を欠損値として扱うことを指定しています。\n:::\n\n読み込んだデータに含まれている変数の名前を確認するため，基本関数`names()`を使います。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nidpos |> names()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"id\"     \"date\"   \"spent\"  \"coupon\"\n```\n\n\n:::\n:::\n\n\nデータの詳細を確認するため，`tidyverse`の`dplyr`パッケージの`glimpse()`関数を使います。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nidpos |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3,000\nColumns: 4\n$ id     <dbl> 12, 32, 30, 29, 46, 44, 44, 32, 3, 34, 36, 3, 42, 18, 38, 4, 19…\n$ date   <chr> \"2019/9/25\", \"2019/9/10\", \"2019/9/9\", \"2019/9/4\", \"2019/9/10\", …\n$ spent  <dbl> 14326, 10232, 6881, 6365, 7595, 7858, 9405, 1821, 8375, 1828, 6…\n$ coupon <dbl> 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, …\n```\n\n\n:::\n:::\n\n\nExcelのようにデータを表示させたいなら，基本関数`View()`を使います。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nView(idpos)\n```\n:::\n\n\nこれで，自分が読み込んだデータがどんなものかを確認できました。\n\n### dplyrでデータの要約\n\n`tidyverse`の`dplyr`パッケージを使うと，データの要約が簡単にできます。\nここでは，\n\n- `summarise()`関数：データの要約統計量を計算する\n- `mutate()`関数：新しい変数を作成する\n- `filter()`関数：条件に合う行を抽出する\n- `select()`関数：特定の変数を抽出する\n- `arrange()`関数：データを並び替える\n- `rename()`関数：変数の名前を変更する\n\nの使い方を学びます。\n\n先ほど読み込んだデータには，\n\n- id：顧客ID\n- date：購入日\n- spent：購入金額\n- coupon：クーポン利用の有無 (1=利用, 0=未利用)\n\nという4変数に3,000の観測値が含まれています。\nこのデータを`dplyr`の各関数を使って，以下のような操作をしてみます。\n\nまず，\n\n1. `select()`関数で`spent`と`coupon`を抽出し，\n2. `arrange()`関数で`spent`の降順に並び替え，\n3. `mutate()`関数で`spent`の金額を10倍した`spent10`という新しい変数を作成し，\n4. `filter()`関数で`spent10`が10000以上の行を抽出し，\n5. `summarise()`関数で`spent10`の平均を計算し，\n6. `rename()`関数で`spent10`を`spent_times10`に名前変更する，\n\nという一連の操作を行います(この処理に意味はないです。)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# コード4-11（見本コード）\nidpos |>\n  select(spent, coupon) |>\n  arrange(desc(spent)) |>\n  mutate(spent10 = spent * 10) |>\n  filter(spent10 >= 10000) |>\n  summarise(mean_spent10 = mean(spent10)) |>\n  rename(spent_times10 = mean_spent10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"spent_times10\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"82391.01\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nすると，spentを10倍して，1万円以上の買い物の平均値を計算した結果が`spent_times10`として表示されます。\n\nこのように加工したデータを`csv`ファイルとして保存するには、`readr`パッケージの`write_csv()`関数を使います。\n`write_csv()`関数は、第1引数に保存したいデータフレームを指定し、第2引数に保存先のファイルパスを指定します。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreadr::write_csv(idpos, path = \"data/new_data.csv\")  \n```\n:::\n\n\n### 企業データの処理\n\nMS Excelのファイルを読み込むこともできます。\nここでは，`readxl`パッケージの`read_xlsx()`関数を使って，企業データを読み込みます。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfirmdata <- readxl::read_xlsx(\"data/MktRes_firmdata.xlsx\")\nfirmdata |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,431\nColumns: 31\n$ fyear                  <dbl> 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018,…\n$ legalname              <chr> \"ハウステンボス株式会社\", \"ハウステンボス株式会社\", \"ハウステンボス株式会社\", \"ハ…\n$ ind_en                 <chr> \"Miscellaneous Services\", \"Miscellaneous Servic…\n$ parent                 <chr> \"エイチ・アイ・エス\", \"エイチ・アイ・エス\", \"エイチ・アイ・エス\", \"エイチ・アイ・…\n$ fiscal_month           <chr> \"2011/10\", \"2012/10\", \"2013/10\", \"2014/10\", \"20…\n$ current_liability      <dbl> 65509, 76206, 85459, 98384, 122993, 102805, 131…\n$ ltloans                <dbl> 0, 4781, 23411, 22780, 14319, 77042, 101603, 11…\n$ total_liability        <dbl> 73428, 96734, 125233, 179036, 194254, 237245, 3…\n$ current_assets         <dbl> 102810, 111697, 137515, 196789, 212979, 233531,…\n$ ppent                  <dbl> 12383, 40554, 45511, 48704, 60761, 62291, 83001…\n$ total_assets           <dbl> 139018, 173497, 215913, 281332, 308245, 332385,…\n$ net_assets_per_capital <dbl> 65589, 76763, 90680, 102295, 113990, 95139, 111…\n$ sales                  <dbl> 380805, 431483, 479478, 523246, 537456, 523705,…\n$ sga                    <dbl> 61158, 65654, 69953, 80033, 88284, 90769, 98822…\n$ operating_profit       <dbl> 9407, 11316, 11843, 15906, 19970, 14274, 15915,…\n$ net_profit             <dbl> 8958, 10881, 11190, 11271, 14025, 1305, 15835, …\n$ pnet_profit            <dbl> 8300, 9331, 8903, 9050, 10890, 267, 13259, 1106…\n$ re                     <dbl> 47658, 55966, 63664, 71612, 82150, 80988, 92731…\n$ adv                    <dbl> 8565, 9691, 10694, 11665, 12969, 12647, 12371, …\n$ labor_cost             <dbl> 30624, 31743, 31648, 37240, 40402, 41505, 46583…\n$ rd                     <dbl> 0, 0, 0, 0, 0, 0, 0, 176, 0, 0, 0, 0, 0, 0, 0, …\n$ other_sg               <dbl> 14962, 17078, 19720, 21648, 24043, 24710, 26067…\n$ emp                    <dbl> 6265, 8310, 9026, 9652, 10143, 10845, 13510, 13…\n$ temp                   <dbl> 1751, 2470, 2750, 3071, 3469, 3535, 3422, 3179,…\n$ tempratio              <dbl> 0.2184381, 0.2291280, 0.2335258, 0.2413739, 0.2…\n$ indgrowth              <dbl> -0.0038649153, 0.0780674898, -0.0737512474, 0.0…\n$ adint                  <dbl> 0.02249183, 0.02245975, 0.02230342, 0.02229353,…\n$ rdint                  <dbl> 0.0000000000, 0.0000000000, 0.0000000000, 0.000…\n$ mkexp                  <dbl> 0.16060188, 0.15215895, 0.14589408, 0.15295482,…\n$ op                     <dbl> 0.02470293, 0.02622583, 0.02469978, 0.03039870,…\n$ roa                    <dbl> 0.0597044987, 0.0537819098, 0.0412342008, 0.032…\n```\n\n\n:::\n:::\n\n\n31変数1,431観測値からならなるデータが読み込まれました。\n必要な変数が変わることもあるかと思うので、先に必要な変数名をベクトル`vars_list`として保存しておきます。\n\n必要な観測値と変数だけを抽出して、新しい変数を作成し、並び替えて、新しいオブジェクト`firm2018_check`に格納します。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\n# 必要な変数のリスト\nvars_list <- c(\"legalname\", \"fyear\", \"sales\", \"labor_cost\", \"emp\", \"temp\")\n\n# コード4-28\nfirm2018_check <- firmdata |>\n  filter(fyear == 2018) |> # 2018年のデータを抽出\n  select(all_of(vars_list)) |> # 必要な変数を選択\n  mutate(wage = labor_cost / (temp + emp), na.rm = TRUE) |> # 新しい変数wageを作成\n  # temp + empが0でないチェックが必要かも\n  arrange(desc(wage)) # wageの降順に並び替え\nhead(firm2018_check, n = 10) # 先頭10行を表示\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"legalname\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"fyear\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sales\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"labor_cost\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"emp\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"temp\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wage\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"na.rm\"],\"name\":[8],\"type\":[\"lgl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"株式会社リクルート\",\"2\":\"2018\",\"3\":\"2310756\",\"4\":\"388583\",\"5\":\"45856\",\"6\":\"2449\",\"7\":\"8.044364\",\"8\":\"TRUE\"},{\"1\":\"株式会社 大丸松坂屋百貨店\",\"2\":\"2018\",\"3\":\"459840\",\"4\":\"62692\",\"5\":\"6695\",\"6\":\"3581\",\"7\":\"6.100817\",\"8\":\"TRUE\"},{\"1\":\"株式会社 帝国ホテル\",\"2\":\"2018\",\"3\":\"58426\",\"4\":\"17307\",\"5\":\"1940\",\"6\":\"998\",\"7\":\"5.890742\",\"8\":\"TRUE\"},{\"1\":\"株式会社 髙島屋\",\"2\":\"2018\",\"3\":\"912848\",\"4\":\"83779\",\"5\":\"7761\",\"6\":\"8849\",\"7\":\"5.043889\",\"8\":\"TRUE\"},{\"1\":\"株式会社コメリ\",\"2\":\"2018\",\"3\":\"346862\",\"4\":\"43991\",\"5\":\"4646\",\"6\":\"4777\",\"7\":\"4.668471\",\"8\":\"TRUE\"},{\"1\":\"株式会社オートバックスセブン\",\"2\":\"2018\",\"3\":\"213840\",\"4\":\"22139\",\"5\":\"4171\",\"6\":\"747\",\"7\":\"4.501627\",\"8\":\"TRUE\"},{\"1\":\"株式会社ロイヤルホテル\",\"2\":\"2018\",\"3\":\"40884\",\"4\":\"13115\",\"5\":\"2049\",\"6\":\"894\",\"7\":\"4.456337\",\"8\":\"TRUE\"},{\"1\":\"オルビス株式会社\",\"2\":\"2018\",\"3\":\"248574\",\"4\":\"28555\",\"5\":\"4181\",\"6\":\"2330\",\"7\":\"4.385655\",\"8\":\"TRUE\"},{\"1\":\"株式会社ファンケル\",\"2\":\"2018\",\"3\":\"122496\",\"4\":\"15103\",\"5\":\"1381\",\"6\":\"2213\",\"7\":\"4.202282\",\"8\":\"TRUE\"},{\"1\":\"近畿日本ツーリスト株式会社\",\"2\":\"2018\",\"3\":\"411821\",\"4\":\"38186\",\"5\":\"6956\",\"6\":\"2189\",\"7\":\"4.175615\",\"8\":\"TRUE\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n:::{.column-margin}\n`all_of()`関数は、`select()`関数内で使用され、変数名のベクトルを指定して、その変数を選択するために使います。これにより、変数名が動的に指定でき、コードの柔軟性が向上します。\n:::\n\n## 4 データの要約\n\n大規模データをあつかうとき、データそのものを眺めていても特徴をつかむことは難しいので、そのデータを特徴付ける代表値を計算して、そこからデータの特徴をつかみます。\n主要な代表値として、平均値(mean)や中央値(median)、散らばり具合を示す分散(variance)や標準偏差(standard deviation)があります。\nそれぞれ、\n\n- 平均値：`mean()`関数\n- 中央値：`median()`関数\n- 分散：`var()`関数\n- 標準偏差：`sd()`関数\n\nを使って計算します。\n\n先ほどのデータ`firm2018_check`の`sales`変数について、代表値を計算してみます。\nここでは、`dplyr`パッケージの`summarize()`関数を使って、平均、中央値、分散、標準偏差を一度に計算します。\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfirm2018_check |> \n  summarize(\n    mean_sales   = mean(sales),\n    median_sales = median(sales),\n    var_sales    = var(sales),\n    sd_sales     = sd(sales)\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"mean_sales\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"median_sales\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"var_sales\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd_sales\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1242425\",\"2\":\"526675\",\"3\":\"3.69048e+12\",\"4\":\"1921062\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n## カテゴリ変数の要約\n\nつぎに、データ上は数値や文字列として記録されていても、その数値や文字列がカテゴリーを表す名義尺度(nominal scale)である場合を考えましょう。\n\n例えば、`firmdata`の中の産業分類を表す`ind_en`変数は、文字列で表現されていますが、その文字列はある観測値が所属するカテゴリーを表しています。\n`fyear`変数は数値ですが、これは年度を表すカテゴリー変数です。\n\nカテゴリ内の観測値の頻度を確認するには基本関数`table()`を使いますが、ここでは、dplyr::`count()`関数を使って、`ind_en`変数の各カテゴリーの頻度を計算し、`gt`パッケージで表形式で表示します。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfirm2018 <- firmdata |>\n  filter(fyear == 2018) # 2018年のデータを抽出\nfirm2018 |>\n  dplyr::count(ind_en, name = \"企業数\") |>\n  gt::gt() |>\n  gtExtras::gt_theme_538()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ibsbgwyqjx\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Cairo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n#ibsbgwyqjx table {\n  font-family: Cairo, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ibsbgwyqjx thead, #ibsbgwyqjx tbody, #ibsbgwyqjx tfoot, #ibsbgwyqjx tr, #ibsbgwyqjx td, #ibsbgwyqjx th {\n  border-style: none;\n}\n\n#ibsbgwyqjx p {\n  margin: 0;\n  padding: 0;\n}\n\n#ibsbgwyqjx .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: 400;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: none;\n  border-top-width: 3px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ibsbgwyqjx .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ibsbgwyqjx .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ibsbgwyqjx .gt_heading {\n  background-color: #FFFFFF;\n  text-align: left;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_bottom_border {\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_col_headings {\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #000000;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ibsbgwyqjx .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ibsbgwyqjx .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ibsbgwyqjx .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ibsbgwyqjx .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #000000;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ibsbgwyqjx .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ibsbgwyqjx .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #000000;\n  border-bottom-style: solid;\n  border-bottom-width: 1px;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ibsbgwyqjx .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #000000;\n  border-bottom-style: solid;\n  border-bottom-width: 1px;\n  border-bottom-color: #FFFFFF;\n  vertical-align: middle;\n}\n\n#ibsbgwyqjx .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ibsbgwyqjx .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ibsbgwyqjx .gt_row {\n  padding-top: 3px;\n  padding-bottom: 3px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ibsbgwyqjx .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 0px;\n  border-right-color: #FFFFFF;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ibsbgwyqjx .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ibsbgwyqjx .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ibsbgwyqjx .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ibsbgwyqjx .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ibsbgwyqjx .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ibsbgwyqjx .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ibsbgwyqjx .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ibsbgwyqjx .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ibsbgwyqjx .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ibsbgwyqjx .gt_sourcenote {\n  font-size: 12px;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ibsbgwyqjx .gt_left {\n  text-align: left;\n}\n\n#ibsbgwyqjx .gt_center {\n  text-align: center;\n}\n\n#ibsbgwyqjx .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ibsbgwyqjx .gt_font_normal {\n  font-weight: normal;\n}\n\n#ibsbgwyqjx .gt_font_bold {\n  font-weight: bold;\n}\n\n#ibsbgwyqjx .gt_font_italic {\n  font-style: italic;\n}\n\n#ibsbgwyqjx .gt_super {\n  font-size: 65%;\n}\n\n#ibsbgwyqjx .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ibsbgwyqjx .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ibsbgwyqjx .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ibsbgwyqjx .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ibsbgwyqjx .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ibsbgwyqjx .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ibsbgwyqjx .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#ibsbgwyqjx .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#ibsbgwyqjx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n\ntbody tr:last-child {\n  border-bottom: 2px solid #ffffff00;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"ind_en\">ind_en</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"a企業数\">企業数</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Air Transportation</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">8</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Amusement Services</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">4</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Bakery Products</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Communication Services</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">2</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Cosmetics &amp; Toilet Goods</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">3</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Department Stores</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">7</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Foods, NEC</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Home &amp; Pre-Fabs</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">2</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Hotels</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">5</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Miscellaneous Services</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">27</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Miscellaneous Wholesales</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">2</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Motor Vehicles</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">4</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Musical Instrument</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Railroad (Major)</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">27</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Railroad (Minor)</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">2</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Real Estate - Sales</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Retail Stores, NEC</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">35</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Supermarket Chains</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">14</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Trucking</td>\n<td headers=\"企業数\" class=\"gt_row gt_right\">1</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n:::{.column-margin}\n教科書のように`table()`関数を使うと簡単に頻度表が作れますが、オブジェクトの型が`table`型になってしまい、後で他の処理に使いにくくなるので、`data.frame`型のまま処理できる`dplyr::count()`関数を使いました。\n:::\n\n広告費を表す`adient`変数の観測値が全企業の中央値より大きいか否か、でダミー変数`ad_dummy`を作成し、`ind_en`変数と`ad_dummy`変数のクロス集計表を作成します。\n\n教科書を先取りしますが、`if_else()`関数を使ってダミー変数を作成し、`count()`関数でクロス集計表を作成し、`gt`パッケージで表形式で表示します。\n`tidyr`パッケージの`pivot_wider()`関数を使って、クロス集計表が見やすくなるように、縦は産業名、横は広告費が中央値より大きいか否か、で表示するように変形しています。\n\n:::{.column-margin}\n`table()`関数を使うと簡単にクロス集計表が作れますが、あえて`data.frame`型のまま処理できる`dplyr::count()`関数を使っています。そのため、データが矩形データのまま扱えるので、後で他の処理に使いやすくなるものの、表にすると見にくくなるので、`tidyr::pivot_wider()`関数で見やすく変形しています。\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfirm2018 <- firm2018 |>\n  mutate(\n    ad_dummy = if_else(adint > median(adint, na.rm = TRUE), 1L, 0L)\n    )\nfirm2018 %>%\n  count(ind_en, ad_dummy) |>\n  tidyr::pivot_wider(names_from = ad_dummy, values_from = n, values_fill = 0) |>\n  gt::gt() |>\n  gtExtras::gt_theme_538()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"aulvjewkwn\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Cairo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n#aulvjewkwn table {\n  font-family: Cairo, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#aulvjewkwn thead, #aulvjewkwn tbody, #aulvjewkwn tfoot, #aulvjewkwn tr, #aulvjewkwn td, #aulvjewkwn th {\n  border-style: none;\n}\n\n#aulvjewkwn p {\n  margin: 0;\n  padding: 0;\n}\n\n#aulvjewkwn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: 400;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: none;\n  border-top-width: 3px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#aulvjewkwn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#aulvjewkwn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#aulvjewkwn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: left;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_bottom_border {\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_col_headings {\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #000000;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#aulvjewkwn .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#aulvjewkwn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#aulvjewkwn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#aulvjewkwn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #000000;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#aulvjewkwn .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#aulvjewkwn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #000000;\n  border-bottom-style: solid;\n  border-bottom-width: 1px;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#aulvjewkwn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #000000;\n  border-bottom-style: solid;\n  border-bottom-width: 1px;\n  border-bottom-color: #FFFFFF;\n  vertical-align: middle;\n}\n\n#aulvjewkwn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#aulvjewkwn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#aulvjewkwn .gt_row {\n  padding-top: 3px;\n  padding-bottom: 3px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#aulvjewkwn .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 0px;\n  border-right-color: #FFFFFF;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aulvjewkwn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#aulvjewkwn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#aulvjewkwn .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#aulvjewkwn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aulvjewkwn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#aulvjewkwn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aulvjewkwn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#aulvjewkwn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aulvjewkwn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#aulvjewkwn .gt_sourcenote {\n  font-size: 12px;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#aulvjewkwn .gt_left {\n  text-align: left;\n}\n\n#aulvjewkwn .gt_center {\n  text-align: center;\n}\n\n#aulvjewkwn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#aulvjewkwn .gt_font_normal {\n  font-weight: normal;\n}\n\n#aulvjewkwn .gt_font_bold {\n  font-weight: bold;\n}\n\n#aulvjewkwn .gt_font_italic {\n  font-style: italic;\n}\n\n#aulvjewkwn .gt_super {\n  font-size: 65%;\n}\n\n#aulvjewkwn .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#aulvjewkwn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#aulvjewkwn .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#aulvjewkwn .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#aulvjewkwn .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#aulvjewkwn .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#aulvjewkwn .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#aulvjewkwn .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#aulvjewkwn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n\ntbody tr:last-child {\n  border-bottom: 2px solid #ffffff00;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"ind_en\">ind_en</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"a0\">0</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"a1\">1</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Air Transportation</td>\n<td headers=\"0\" class=\"gt_row gt_right\">4</td>\n<td headers=\"1\" class=\"gt_row gt_right\">4</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Amusement Services</td>\n<td headers=\"0\" class=\"gt_row gt_right\">4</td>\n<td headers=\"1\" class=\"gt_row gt_right\">0</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Bakery Products</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Communication Services</td>\n<td headers=\"0\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Cosmetics &amp; Toilet Goods</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">3</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Department Stores</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">7</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Foods, NEC</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Home &amp; Pre-Fabs</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">2</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Hotels</td>\n<td headers=\"0\" class=\"gt_row gt_right\">5</td>\n<td headers=\"1\" class=\"gt_row gt_right\">0</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Miscellaneous Services</td>\n<td headers=\"0\" class=\"gt_row gt_right\">17</td>\n<td headers=\"1\" class=\"gt_row gt_right\">10</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Miscellaneous Wholesales</td>\n<td headers=\"0\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Motor Vehicles</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">4</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Musical Instrument</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Railroad (Major)</td>\n<td headers=\"0\" class=\"gt_row gt_right\">27</td>\n<td headers=\"1\" class=\"gt_row gt_right\">0</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Railroad (Minor)</td>\n<td headers=\"0\" class=\"gt_row gt_right\">2</td>\n<td headers=\"1\" class=\"gt_row gt_right\">0</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Real Estate - Sales</td>\n<td headers=\"0\" class=\"gt_row gt_right\">0</td>\n<td headers=\"1\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Retail Stores, NEC</td>\n<td headers=\"0\" class=\"gt_row gt_right\">11</td>\n<td headers=\"1\" class=\"gt_row gt_right\">24</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Supermarket Chains</td>\n<td headers=\"0\" class=\"gt_row gt_right\">2</td>\n<td headers=\"1\" class=\"gt_row gt_right\">12</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Trucking</td>\n<td headers=\"0\" class=\"gt_row gt_right\">1</td>\n<td headers=\"1\" class=\"gt_row gt_right\">0</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n次に、カテゴリ変数ごとに処理を行いたい場合、例えば、産業分類ごとに売上高の平均値や標準偏差を計算したい場合は、`group_by()`関数を使って、カテゴリ変数でグループ化してから、`summarize()`関数で集計します。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# コード4-39\nfirm2018 |>\n  group_by(ind_en) |>\n  summarize(\n      obs = n(),\n      sales_m = mean(sales),\n      sales_sd = sd(sales),\n      adint_m = mean(adint),\n      adint_sd = sd(adint)\n      ) |>\n  gt::gt() |>\n  gt::fmt_number(\n    columns = c(sales_m, sales_sd, adint_m, adint_sd),\n    decimals = 2\n  ) |>\n  gtExtras::gt_theme_538()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"kcggaziikf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n@import url(\"https://fonts.googleapis.com/css2?family=Cairo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\");\n#kcggaziikf table {\n  font-family: Cairo, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#kcggaziikf thead, #kcggaziikf tbody, #kcggaziikf tfoot, #kcggaziikf tr, #kcggaziikf td, #kcggaziikf th {\n  border-style: none;\n}\n\n#kcggaziikf p {\n  margin: 0;\n  padding: 0;\n}\n\n#kcggaziikf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: 400;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: none;\n  border-top-width: 3px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#kcggaziikf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#kcggaziikf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#kcggaziikf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: left;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_bottom_border {\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_col_headings {\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #000000;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#kcggaziikf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#kcggaziikf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#kcggaziikf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#kcggaziikf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #000000;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#kcggaziikf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#kcggaziikf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #000000;\n  border-bottom-style: solid;\n  border-bottom-width: 1px;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#kcggaziikf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: none;\n  border-top-width: 2px;\n  border-top-color: #000000;\n  border-bottom-style: solid;\n  border-bottom-width: 1px;\n  border-bottom-color: #FFFFFF;\n  vertical-align: middle;\n}\n\n#kcggaziikf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#kcggaziikf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#kcggaziikf .gt_row {\n  padding-top: 3px;\n  padding-bottom: 3px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#kcggaziikf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 0px;\n  border-right-color: #FFFFFF;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kcggaziikf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#kcggaziikf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#kcggaziikf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#kcggaziikf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kcggaziikf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#kcggaziikf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kcggaziikf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#kcggaziikf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kcggaziikf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kcggaziikf .gt_sourcenote {\n  font-size: 12px;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kcggaziikf .gt_left {\n  text-align: left;\n}\n\n#kcggaziikf .gt_center {\n  text-align: center;\n}\n\n#kcggaziikf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#kcggaziikf .gt_font_normal {\n  font-weight: normal;\n}\n\n#kcggaziikf .gt_font_bold {\n  font-weight: bold;\n}\n\n#kcggaziikf .gt_font_italic {\n  font-style: italic;\n}\n\n#kcggaziikf .gt_super {\n  font-size: 65%;\n}\n\n#kcggaziikf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#kcggaziikf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#kcggaziikf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#kcggaziikf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#kcggaziikf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#kcggaziikf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#kcggaziikf .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#kcggaziikf .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#kcggaziikf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n\ntbody tr:last-child {\n  border-bottom: 2px solid #ffffff00;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"ind_en\">ind_en</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"obs\">obs</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"sales_m\">sales_m</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"sales_sd\">sales_sd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"adint_m\">adint_m</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;\" scope=\"col\" id=\"adint_sd\">adint_sd</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Air Transportation</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">8</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">1,772,786.50</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">305,239.60</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Amusement Services</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">4</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">298,137.50</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">263,017.35</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Bakery Products</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">1</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">1,059,442.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Communication Services</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">2</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">547,087.50</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">172,735.58</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.03</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Cosmetics &amp; Toilet Goods</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">3</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">140,669.33</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">100,063.48</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.11</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.05</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Department Stores</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">7</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">843,248.29</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">348,818.99</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.01</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Foods, NEC</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">1</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">504,153.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Home &amp; Pre-Fabs</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">2</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">4,143,505.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Hotels</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">5</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">62,134.80</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">58,060.28</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Miscellaneous Services</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">27</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">311,867.22</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">456,036.57</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.02</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Miscellaneous Wholesales</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">2</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">176,520.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">52,778.45</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.03</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Motor Vehicles</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">4</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">5,279,121.75</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">4,233,187.72</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.03</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Musical Instrument</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">1</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">434,373.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.04</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Railroad (Major)</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">27</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">1,302,920.52</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">1,037,834.05</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Railroad (Minor)</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">2</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">260,502.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.00</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Real Estate - Sales</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">1</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">1,861,195.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Retail Stores, NEC</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">35</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">571,019.17</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">547,246.68</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.02</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.03</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Supermarket Chains</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">14</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">4,335,164.07</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">3,511,346.59</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.01</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">0.01</td></tr>\n    <tr><td headers=\"ind_en\" class=\"gt_row gt_left\">Trucking</td>\n<td headers=\"obs\" class=\"gt_row gt_right\">1</td>\n<td headers=\"sales_m\" class=\"gt_row gt_right\">1,118,094.00</td>\n<td headers=\"sales_sd\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"adint_m\" class=\"gt_row gt_right\">0.00</td>\n<td headers=\"adint_sd\" class=\"gt_row gt_right\">NA</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n<!-- \n\n\n# コード4-40\nX <-tibble(\n  x1 = c(-3, -1, 0, 2, 5),\n  y1 = c(16, 12, 10, 6, 0),\n  y2 = c(8, 6, 5, 3, 0)\n)\nX\n\n# コード4-41\ncor(X$x1, X$y1)\n\n# コード4-42\n# For mac users\n# set_theme(theme_gray(base_size = 10, base_family = \"HiraMinProN-W3\"))\n\n# コード4-43\nggplot (data = X, mapping = aes(x = x1, y = y1)) +\n  geom_point() +\n  geom_smooth(method = lm)\n\n# コード4-44\nAB <- tibble(A = c(-2, -1, 0, 1, 2), B = c(4, 1, 0, 1, 4))\nAB\n\n\n# コード4-45\ncor(AB$A, AB$B)\n\n# コード4-46\nggplot(data = AB, mapping = aes(x = A, y = B)) +\n  geom_point() +\n  geom_smooth(\n    method = lm,\n    formula = y ~ x + I(x^2),\n    se = FALSE\n  )\n\n# コード4-47\nidpos <- readr::read_csv(\"data/2022idpos.csv\", na = \".\")\nhead(idpos)\n\n# コード4-48\nidpos$datediff <-\n  as.numeric(difftime(\"2019-10-02\", idpos$date, units = \"days\"))\nhead(idpos)\n\n# コード4-49\nidpos_cust <- idpos %>%\n  group_by(id) %>%\n  summarize(frequency = n(),\n            monetary = sum(spent),\n            cherry = sum(coupon),\n            recency = min(datediff)\n            )\nhead(idpos_cust)\n\n# コード4-50\nidpos_cust_m <- idpos_cust %>%\n  arrange(desc(monetary))\n\n# 上位 10 人の顧客 (Monetary)\nidpos_cust_m[1:10, ]\n\n# コード4-51\nid_data <- readr::read_csv(\"data/id_data.csv\", na = \".\")\nstr(id_data)\n\n# コード4-52\nidpos_cust <- left_join(idpos_cust, id_data, by = \"id\")\nhead(idpos_cust)\n\n# コード4-53\nidpos_cust_m <- idpos_cust %>%\n  arrange(desc(monetary))\n\n# 上位顧客 20 人中の男女比\ntable(idpos_cust_m[1:20, ]$gender)\n\n# コード4-54\nidpos_cust_m$decile_rank <-\n  cut(idpos_cust_m$monetary,\n      quantile(idpos_cust_m$monetary, (0:10) / 10, na.rm = TRUE),\n      label = FALSE, include.lowest = TRUE)\nhead(idpos_cust_m)\n\n# コード4-55\ndecile <- idpos_cust_m %>%\n  group_by(decile_rank) %>%\n  summarize(freq = n(),\n            monetary = sum(monetary))\ntotal <- sum(decile$monetary)\n\ndecile2 <- decile %>%\n  mutate(percent = monetary / total * 100) %>%\n  arrange(desc(decile_rank))\n\ndecile2\n\n# コード4-56\nsales_wide <- readr::read_csv(\"data/sales_wide.csv\", na = \".\")\nsales_wide\n\n# コード4-57\nsales_long <- gather(data = sales_wide,\n                     key = \"month\", value = \"sales\", starts_with(\"sales\"))\nsales_long\n\n# コード4-58\nsales_long <- sales_wide %>%\n  rename('06'  = sales06,\n         '07'  = sales07,\n         '08'  = sales08,\n         '09'  = sales09,\n         '10'  = sales10) %>%\n  gather(key = \"month\", value = \"sales\", '06':'10') %>%\n  arrange(store)\nsales_long\n\n# コード4-59\nwide_test <- sales_long %>%\n  spread(key = \"month\", value = \"sales\") %>%\n  rename(sales06 = '06',\n         sales07 = '07',\n         sales08 = '08',\n         sales09 = '09',\n         sales10 = '10')\nwide_test\n\n\n```\n--->\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}